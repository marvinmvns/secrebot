<div class="container-fluid mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="fab fa-linkedin me-2"></i>Análise de Perfil do LinkedIn</h3>
        </div>
        <div class="card-body">
            <!-- Credential Status -->
            <div id="credentialStatus" class="alert <%= locals.credentialStatus?.hasCredentials ? 'alert-success' : 'alert-warning' %>" role="alert">
                <h5 class="alert-heading"><%= locals.credentialStatus?.status || 'Status Indisponível' %></h5>
                <p><%= locals.credentialStatus?.message || 'Não foi possível verificar as credenciais.' %></p>
                <% if (!locals.credentialStatus?.hasCredentials) { %>
                    <hr>
                    <a href="/config" class="btn btn-sm btn-outline-primary mt-2">Ir para Configurações</a>
                <% } %>
            </div>

            <!-- Formulário de Análise -->
            <form action="/linkedin/analyze" method="POST" class="mb-4">
                <div class="mb-3">
                    <label for="url" class="form-label"><strong>URL do Perfil do LinkedIn:</strong></label>
                    <input type="url" id="url" name="url" class="form-control" placeholder="https://www.linkedin.com/in/..." required value="<%= locals.url || '' %>">
                </div>
                <div class="mb-3">
                    <label for="analysisType" class="form-label"><strong>Tipo de Análise:</strong></label>
                    <select id="analysisType" name="analysisType" class="form-select">
                        <option value="structured" <%= (locals.analysisType === 'structured' || !locals.analysisType) ? 'selected' : '' %>>Estruturada (Completa)</option>
                        <option value="raw" <%= locals.analysisType === 'raw' ? 'selected' : '' %>>Apenas Texto Bruto</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search me-2"></i>Analisar Perfil
                </button>
            </form>

            <% if (locals.error) { %>
            <div class="alert alert-danger" role="alert">
                <h5 class="alert-heading">Erro na Análise</h5>
                <p><%= locals.error %></p>
            </div>
            <% } %>

            <% if (requestNewLogin) { %>
              <div class="card mt-4 border-warning">
                  <div class="card-header bg-warning text-dark">
                      <strong><i class="fas fa-key"></i> Sessão Expirada ou Inválida</strong>
                  </div>
                  <div class="card-body">
                      <p>Sua sessão do LinkedIn expirou ou é inválida. Por favor, faça o login novamente para continuar.</p>
                      <form action="/linkedin/re-login-and-analyze" method="POST">
                          <!-- Hidden fields to retain original request data -->
                          <input type="hidden" name="url" value="<%= locals.url || '' %>">
                          <input type="hidden" name="analysisType" value="<%= locals.analysisType || '' %>">
                          
                          <div class="mb-3">
                              <label for="linkedinEmail" class="form-label">Email do LinkedIn</label>
                              <input type="email" class="form-control" id="linkedinEmail" name="linkedinEmail" required>
                          </div>
                          <div class="mb-3">
                              <label for="linkedinPassword" class="form-label">Senha do LinkedIn</label>
                              <input type="password" class="form-control" id="linkedinPassword" name="linkedinPassword" required>
                          </div>
                          <button type="submit" class="btn btn-primary w-100">
                              <i class="fas fa-sign-in-alt"></i> Login e Analisar
                          </button>
                      </form>
                  </div>
              </div>
            <% } %>

            <!-- Resultados da Análise -->
            <% if (locals.analysis && locals.analysis.data) { %>
                <% const data = locals.analysis.data; %>
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">Resultados da Análise para: <%= data.name || 'Perfil' %></h4>
                    </div>
                    <div class="card-body">
                        <!-- Profile Header -->
                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <% if (data.profilePictureUrl) { %>
                                    <img src="<%= data.profilePictureUrl %>" alt="Foto do Perfil" class="img-fluid rounded-circle shadow-sm" style="width: 120px; height: 120px; object-fit: cover;">
                                <% } else { %>
                                    <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center text-white" style="width: 120px; height: 120px;">
                                        <span>Sem Foto</span>
                                    </div>
                                <% } %>
                            </div>
                            <div class="col-md-10">
                                <h3><%= data.name || 'Nome não encontrado' %></h3>
                                <p class="lead text-muted"><%= data.headline || 'Título não encontrado' %></p>
                                <p><i class="fas fa-map-marker-alt me-2 text-secondary"></i><%= data.location || 'Localização não encontrada' %></p>
                                <p><i class="fas fa-users me-2 text-secondary"></i><%= data.connections || 'Conexões não encontradas' %></p>
                            </div>
                        </div>

                        <!-- Data Quality -->
                        <% if (analysis && analysis.dataQuality) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-chart-line"></i> Qualidade dos Dados</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <div class="col-md-6">
                                  <div class="d-flex justify-content-between mb-2">
                                    <span>Pontuação Geral:</span>
                                    <strong><%= analysis.dataQuality.percentage %>%</strong>
                                  </div>
                                  <div class="progress mb-3">
                                    <div class="progress-bar bg-<%= analysis.dataQuality.quality === 'excellent' ? 'success' : analysis.dataQuality.quality === 'high' ? 'info' : analysis.dataQuality.quality === 'medium' ? 'warning' : 'danger' %>" 
                                         style="width: <%= analysis.dataQuality.percentage %>%">
                                    </div>
                                  </div>
                                  <small class="text-muted">
                                    <%= analysis.dataQuality.score %> de <%= analysis.dataQuality.maxScore %> campos preenchidos
                                  </small>
                                </div>
                                <div class="col-md-6">
                                  <div class="row text-center">
                                    <div class="col-3">
                                      <div class="border rounded p-2">
                                        <div class="h6 mb-0"><%= analysis.dataQuality.details.basicInfo %></div>
                                        <small class="text-muted">Básico</small>
                                      </div>
                                    </div>
                                    <div class="col-3">
                                      <div class="border rounded p-2">
                                        <div class="h6 mb-0"><%= analysis.dataQuality.details.detailedInfo %></div>
                                        <small class="text-muted">Detalhado</small>
                                      </div>
                                    </div>
                                    <div class="col-3">
                                      <div class="border rounded p-2">
                                        <div class="h6 mb-0"><%= analysis.dataQuality.details.additionalSections %></div>
                                        <small class="text-muted">Adicional</small>
                                      </div>
                                    </div>
                                    <div class="col-3">
                                      <div class="border rounded p-2">
                                        <div class="h6 mb-0"><%= analysis.dataQuality.details.extendedInfo %></div>
                                        <small class="text-muted">Estendido</small>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Informações de Contato -->
                        <% if (analysis && analysis.contactInfo && Object.values(analysis.contactInfo).some(v => v)) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-address-book"></i> Informações de Contato</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% if (analysis.contactInfo.email) { %>
                                  <div class="col-md-4 mb-2">
                                    <strong>Email:</strong><br>
                                    <a href="mailto:<%= analysis.contactInfo.email %>"><%= analysis.contactInfo.email %></a>
                                  </div>
                                <% } %>
                                <% if (analysis.contactInfo.phone) { %>
                                  <div class="col-md-4 mb-2">
                                    <strong>Telefone:</strong><br>
                                    <a href="tel:<%= analysis.contactInfo.phone %>"><%= analysis.contactInfo.phone %></a>
                                  </div>
                                <% } %>
                                <% if (analysis.contactInfo.website) { %>
                                  <div class="col-md-4 mb-2">
                                    <strong>Website:</strong><br>
                                    <a href="<%= analysis.contactInfo.website %>" target="_blank"><%= analysis.contactInfo.website %></a>
                                  </div>
                                <% } %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Projetos -->
                        <% if (analysis && analysis.projects && analysis.projects.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-project-diagram"></i> Projetos (<%= analysis.projects.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="projectsAccordion">
                                <% analysis.projects.forEach((project, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#project<%= index %>">
                                        <strong><%= project.title %></strong>
                                        <% if (project.date) { %>
                                          <span class="badge bg-secondary ms-2"><%= project.date %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="project<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (project.description) { %>
                                          <p><%= project.description %></p>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Cursos -->
                        <% if (analysis && analysis.courses && analysis.courses.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-graduation-cap"></i> Cursos (<%= analysis.courses.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.courses.forEach(course => { %>
                                  <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                      <h6 class="mb-1"><%= course.name %></h6>
                                      <% if (course.institution) { %>
                                        <small class="text-muted"><%= course.institution %></small><br>
                                      <% } %>
                                      <% if (course.date) { %>
                                        <small class="text-muted"><%= course.date %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Recomendações -->
                        <% if (analysis && analysis.recommendations && analysis.recommendations.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-star"></i> Recomendações (<%= analysis.recommendations.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="recommendationsAccordion">
                                <% analysis.recommendations.forEach((rec, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#rec<%= index %>">
                                        <strong><%= rec.recommender %></strong>
                                        <% if (rec.relationship) { %>
                                          <span class="badge bg-info ms-2"><%= rec.relationship %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="rec<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (rec.text) { %>
                                          <p class="fst-italic">"<%= rec.text %>"</p>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Interesses -->
                        <% if (analysis && analysis.interests && analysis.interests.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-heart"></i> Interesses (<%= analysis.interests.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="d-flex flex-wrap gap-2">
                                <% analysis.interests.forEach(interest => { %>
                                  <span class="badge bg-light text-dark border"><%= interest %></span>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Patentes -->
                        <% if (analysis && analysis.patents && analysis.patents.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Patentes (<%= analysis.patents.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="patentsAccordion">
                                <% analysis.patents.forEach((patent, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#patent<%= index %>">
                                        <strong><%= patent.title %></strong>
                                        <% if (patent.date) { %>
                                          <span class="badge bg-secondary ms-2"><%= patent.date %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="patent<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (patent.description) { %>
                                          <p><%= patent.description %></p>
                                        <% } %>
                                        <% if (patent.issuer) { %>
                                          <small class="text-muted">Emissor: <%= patent.issuer %></small>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Test Scores -->
                        <% if (analysis && analysis.testScores && analysis.testScores.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-chart-bar"></i> Resultados de Testes (<%= analysis.testScores.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.testScores.forEach(score => { %>
                                  <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                      <h6 class="mb-1"><%= score.test %></h6>
                                      <div class="d-flex justify-content-between">
                                        <span>Pontuação:</span>
                                        <strong><%= score.score %></strong>
                                      </div>
                                      <% if (score.date) { %>
                                        <small class="text-muted"><%= score.date %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Experiência -->
                        <% if (analysis && analysis.experience && analysis.experience.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-briefcase"></i> Experiência (<%= analysis.experience.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="experienceAccordion">
                                <% analysis.experience.forEach((exp, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exp<%= index %>">
                                        <strong><%= exp.title %></strong>
                                        <% if (exp.company) { %>
                                          <span class="badge bg-primary ms-2"><%= exp.company %></span>
                                        <% } %>
                                        <% if (exp.duration) { %>
                                          <span class="badge bg-secondary ms-2"><%= exp.duration %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="exp<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (exp.description) { %>
                                          <p><%= exp.description %></p>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Educação -->
                        <% if (analysis && analysis.education && analysis.education.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-university"></i> Educação (<%= analysis.education.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.education.forEach(edu => { %>
                                  <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                      <h6 class="mb-1"><%= edu.degree %></h6>
                                      <% if (edu.school) { %>
                                        <small class="text-muted"><%= edu.school %></small><br>
                                      <% } %>
                                      <% if (edu.years) { %>
                                        <small class="text-muted"><%= edu.years %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Skills -->
                        <% if (analysis && analysis.skills && analysis.skills.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-tools"></i> Skills (<%= analysis.skills.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="d-flex flex-wrap gap-2">
                                <% analysis.skills.forEach(skill => { %>
                                  <span class="badge bg-primary"><%= skill %></span>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Certificações -->
                        <% if (analysis && analysis.certifications && analysis.certifications.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-certificate"></i> Certificações (<%= analysis.certifications.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.certifications.forEach(cert => { %>
                                  <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                      <h6 class="mb-1"><%= cert.name %></h6>
                                      <% if (cert.issuer) { %>
                                        <small class="text-muted"><%= cert.issuer %></small><br>
                                      <% } %>
                                      <% if (cert.issuedDate) { %>
                                        <small class="text-muted"><%= cert.issuedDate %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Publicações -->
                        <% if (analysis && analysis.publications && analysis.publications.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-book"></i> Publicações (<%= analysis.publications.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="publicationsAccordion">
                                <% analysis.publications.forEach((pub, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#pub<%= index %>">
                                        <strong><%= pub.title %></strong>
                                        <% if (pub.publisher) { %>
                                          <span class="badge bg-info ms-2"><%= pub.publisher %></span>
                                        <% } %>
                                        <% if (pub.date) { %>
                                          <span class="badge bg-secondary ms-2"><%= pub.date %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="pub<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (pub.description) { %>
                                          <p><%= pub.description %></p>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Honras e Prêmios -->
                        <% if (analysis && analysis.honors && analysis.honors.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-trophy"></i> Honras e Prêmios (<%= analysis.honors.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.honors.forEach(honor => { %>
                                  <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                      <h6 class="mb-1"><%= honor.title %></h6>
                                      <% if (honor.issuer) { %>
                                        <small class="text-muted"><%= honor.issuer %></small><br>
                                      <% } %>
                                      <% if (honor.date) { %>
                                        <small class="text-muted"><%= honor.date %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Idiomas -->
                        <% if (analysis && analysis.languages && analysis.languages.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-language"></i> Idiomas (<%= analysis.languages.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="row">
                                <% analysis.languages.forEach(lang => { %>
                                  <div class="col-md-4 mb-2">
                                    <div class="border rounded p-2 text-center">
                                      <strong><%= lang.language %></strong><br>
                                      <% if (lang.proficiency) { %>
                                        <small class="text-muted"><%= lang.proficiency %></small>
                                      <% } %>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Voluntariado -->
                        <% if (analysis && analysis.volunteering && analysis.volunteering.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-hands-helping"></i> Voluntariado (<%= analysis.volunteering.length %>)</h6>
                            </div>
                            <div class="card-body">
                              <div class="accordion" id="volunteeringAccordion">
                                <% analysis.volunteering.forEach((vol, index) => { %>
                                  <div class="accordion-item">
                                    <h2 class="accordion-header">
                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#vol<%= index %>">
                                        <strong><%= vol.role %></strong>
                                        <% if (vol.organization) { %>
                                          <span class="badge bg-success ms-2"><%= vol.organization %></span>
                                        <% } %>
                                        <% if (vol.duration) { %>
                                          <span class="badge bg-secondary ms-2"><%= vol.duration %></span>
                                        <% } %>
                                      </button>
                                    </h2>
                                    <div id="vol<%= index %>" class="accordion-collapse collapse">
                                      <div class="accordion-body">
                                        <% if (vol.description) { %>
                                          <p><%= vol.description %></p>
                                        <% } %>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                              </div>
                            </div>
                          </div>
                        <% } %>

                        <!-- Sobre -->
                        <% if (analysis && analysis.summary && analysis.summary.length > 0) { %>
                          <div class="card mb-3">
                            <div class="card-header">
                              <h6 class="mb-0"><i class="fas fa-info-circle"></i> Sobre</h6>
                            </div>
                            <div class="card-body">
                              <p><%= analysis.summary %></p>
                            </div>
                          </div>
                        <% } %>

                        <!-- Accordion for Details -->
                        <div class="accordion" id="linkedinAccordion">
                            <% if (data.about) { %>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingAbout">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAbout" aria-expanded="true" aria-controls="collapseAbout">
                                        <strong><i class="fas fa-user-circle me-2"></i>Sobre</strong>
                                    </button>
                                </h2>
                                <div id="collapseAbout" class="accordion-collapse collapse show" aria-labelledby="headingAbout">
                                    <div class="accordion-body">
                                        <p style="white-space: pre-wrap;"><%= data.about %></p>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            
                            <% if (data.experience && data.experience.length > 0) { %>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingExperience">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExperience" aria-expanded="false" aria-controls="collapseExperience">
                                        <strong><i class="fas fa-briefcase me-2"></i>Experiência Profissional</strong>
                                    </button>
                                </h2>
                                <div id="collapseExperience" class="accordion-collapse collapse" aria-labelledby="headingExperience">
                                    <div class="accordion-body">
                                        <% data.experience.forEach(exp => { %>
                                            <div class="mb-3 border-bottom pb-3">
                                                <h5><%= exp.title %></h5>
                                                <p class="mb-1"><strong><%= exp.company %></strong></p>
                                                <p class="text-muted small"><%= exp.duration %></p>
                                                <p><%= exp.description %></p>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            
                            <% if (data.education && data.education.length > 0) { %>
                             <div class="accordion-item">
                                <h2 class="accordion-header" id="headingEducation">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEducation" aria-expanded="false" aria-controls="collapseEducation">
                                        <strong><i class="fas fa-graduation-cap me-2"></i>Educação</strong>
                                    </button>
                                </h2>
                                <div id="collapseEducation" class="accordion-collapse collapse" aria-labelledby="headingEducation">
                                    <div class="accordion-body">
                                        <% data.education.forEach(edu => { %>
                                            <div class="mb-3 border-bottom pb-3">
                                                <h5><%= edu.degree %></h5>
                                                <p class="mb-1"><%= edu.school %></p>
                                                <p class="text-muted small"><%= edu.years %></p>
                                            </div>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                            <% if (data.skills && data.skills.length > 0) { %>
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingSkills">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSkills" aria-expanded="false" aria-controls="collapseSkills">
                                        <strong><i class="fas fa-cogs me-2"></i>Habilidades</strong>
                                    </button>
                                </h2>
                                <div id="collapseSkills" class="accordion-collapse collapse" aria-labelledby="headingSkills">
                                    <div class="accordion-body">
                                        <% data.skills.forEach(skill => { %>
                                            <span class="badge bg-info text-dark me-2 mb-2"><%= skill %></span>
                                        <% }); %>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                            <!-- Outras Seções -->
                             <% const otherSections = [
                                { title: 'Certificações', data: data.certifications, icon: 'fa-certificate', key: 'cert' },
                                { title: 'Publicações', data: data.publications, icon: 'fa-book-open', key: 'pub' },
                                { title: 'Honras e Prêmios', data: data.honors, icon: 'fa-trophy', key: 'honor' },
                                { title: 'Idiomas', data: data.languages, icon: 'fa-language', key: 'lang' },
                                { title: 'Voluntariado', data: data.volunteering, icon: 'fa-hands-helping', key: 'vol' }
                            ]; %>

                            <% otherSections.forEach((section, index) => { %>
                                <% if (section.data && section.data.length > 0) { %>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading<%= section.key %>">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= section.key %>" aria-expanded="false" aria-controls="collapse<%= section.key %>">
                                            <strong><i class="fas <%= section.icon %> me-2"></i><%= section.title %></strong>
                                        </button>
                                    </h2>
                                    <div id="collapse<%= section.key %>" class="accordion-collapse collapse" aria-labelledby="heading<%= section.key %>">
                                        <div class="accordion-body">
                                            <% section.data.forEach(item => { %>
                                                <div class="mb-3 border-bottom pb-3">
                                                    <% if (section.key === 'cert') { %>
                                                        <h5><%= item.name %></h5>
                                                        <p><%= item.issuer %> - <%= item.issuedDate %></p>
                                                    <% } else if (section.key === 'pub') { %>
                                                        <h5><%= item.title %></h5>
                                                        <p><%= item.publisher %> - <%= item.date %></p>
                                                    <% } else if (section.key === 'honor') { %>
                                                        <h5><%= item.title %></h5>
                                                        <p><%= item.issuer %> - <%= item.date %></p>
                                                    <% } else if (section.key === 'lang') { %>
                                                        <h5><%= item.language %></h5>
                                                        <p><%= item.proficiency %></p>
                                                    <% } else if (section.key === 'vol') { %>
                                                        <h5><%= item.role %></h5>
                                                        <p><%= item.organization %> - <%= item.duration %></p>
                                                    <% } %>
                                                </div>
                                            <% }); %>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                            <% }); %>

                            <!-- Raw Text -->
                             <div class="accordion-item">
                                <h2 class="accordion-header" id="headingRawText">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRawText" aria-expanded="false" aria-controls="collapseRawText">
                                        <strong><i class="fas fa-file-alt me-2"></i>Texto Bruto Extraído</strong>
                                    </button>
                                </h2>
                                <div id="collapseRawText" class="accordion-collapse collapse" aria-labelledby="headingRawText">
                                    <div class="accordion-body">
                                        <textarea class="form-control" rows="15" readonly><%= locals.analysis.rawText || 'Nenhum texto bruto foi extraído.' %></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
</div>

