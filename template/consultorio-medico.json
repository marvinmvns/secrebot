{
  "id": "consultorio-medico-template",
  "name": "Consult√≥rio M√©dico",
  "description": "Template para agendamento de consultas m√©dicas com triagem e lembretes autom√°ticos",
  "alias": "consultorio",
  "version": "1.0.0",
  "metadata": {
    "category": "saude",
    "isTemplate": true,
    "tags": ["medicina", "agendamento", "consulta", "triagem", "saude"],
    "author": "SecreBot Templates",
    "businessType": "healthcare"
  },
  "nodes": [
    {
      "id": "start-1",
      "type": "start",
      "position": { "x": 100, "y": 100 },
      "data": {
        "label": "In√≠cio Atendimento",
        "message": "Atendimento m√©dico iniciado"
      }
    },
    {
      "id": "medical_welcome",
      "type": "message",
      "position": { "x": 300, "y": 100 },
      "data": {
        "label": "Recep√ß√£o M√©dica",
        "message": "üè• *Bem-vindo ao Consult√≥rio Dr. [Nome]*\n\nSou o assistente virtual e estou aqui para ajud√°-lo.\n\nü©∫ *Como posso ajud√°-lo hoje?*\n\nüìÖ Agendar nova consulta\nüîÑ Reagendar consulta existente\n‚ùå Cancelar consulta\nüìã Resultados de exames\nüÜò Emerg√™ncia m√©dica\nüìû Falar com recepcionista\n\n*Digite o n√∫mero da op√ß√£o ou descreva sua necessidade.*\n\n‚ö†Ô∏è *Em caso de emerg√™ncia, ligue 192 (SAMU)*",
        "isMainMenu": true
      }
    },
    {
      "id": "classify_request",
      "type": "llm",
      "position": { "x": 500, "y": 100 },
      "data": {
        "label": "Classificar Solicita√ß√£o",
        "prompt": "Analise a mensagem do paciente e classifique a solicita√ß√£o m√©dica:\n\nCategorias:\n- appointment: Agendar nova consulta\n- reschedule: Reagendar consulta existente\n- cancel: Cancelar consulta\n- results: Consultar resultados de exames\n- emergency: Situa√ß√£o de emerg√™ncia\n- receptionist: Falar com recepcionista\n- info: Informa√ß√µes gerais\n- symptoms: Relatando sintomas\n\nMensagem: {{user_message}}\n\nResponda APENAS com a categoria (appointment, reschedule, cancel, results, emergency, receptionist, info, symptoms).",
        "timeout": 15000,
        "useBalancer": true
      }
    },
    {
      "id": "check_emergency",
      "type": "condition",
      "position": { "x": 700, "y": 100 },
      "data": {
        "label": "Verificar Emerg√™ncia",
        "condition": "llm_output === 'emergency' || user_message.toLowerCase().includes('emergencia') || user_message.toLowerCase().includes('urgente')",
        "description": "Identificar situa√ß√µes de emerg√™ncia"
      }
    },
    {
      "id": "emergency_response",
      "type": "message",
      "position": { "x": 900, "y": 50 },
      "data": {
        "label": "Resposta Emerg√™ncia",
        "message": "üö® *SITUA√á√ÉO DE EMERG√äNCIA DETECTADA*\n\n‚ö° *A√á√ÉO IMEDIATA:*\n‚Ä¢ Ligue 192 (SAMU) agora\n‚Ä¢ Ou v√° ao Pronto Socorro mais pr√≥ximo\n\nüè• *Endere√ßos pr√≥ximos:*\n‚Ä¢ Hospital Municipal - Rua A, 123\n‚Ä¢ UPA 24h - Av. B, 456\n\nüìû *Contatos emerg√™ncia:*\n‚Ä¢ SAMU: 192\n‚Ä¢ Bombeiros: 193\n‚Ä¢ Dr. [Nome]: (11) 99999-9999\n\n*Este assistente N√ÉO substitui atendimento m√©dico presencial em emerg√™ncias!*\n\n‚ö†Ô∏è *Conectando com recepcionista...*"
      }
    },
    {
      "id": "symptom_triage",
      "type": "llm",
      "position": { "x": 500, "y": 300 },
      "data": {
        "label": "Triagem de Sintomas",
        "prompt": "Voc√™ √© um assistente de triagem m√©dica. Analise os sintomas relatados e determine a urg√™ncia:\n\nSintomas relatados: {{user_message}}\n\nClassifique como:\n- EMERG√äNCIA: Sintomas que requerem atendimento imediato\n- URGENTE: Deve ser visto em 24-48h\n- NORMAL: Pode aguardar consulta de rotina\n- ORIENTA√á√ÉO: Pode ser orientado por telefone\n\nSinais de alarme para EMERG√äNCIA:\n- Dor no peito intensa\n- Dificuldade respirat√≥ria severa\n- Perda de consci√™ncia\n- Sangramento intenso\n- Dor abdominal severa\n- Febre alta (>39¬∞C) em crian√ßas\n\nRetorne:\nCLASSIFICA√á√ÉO: [EMERG√äNCIA/URGENTE/NORMAL/ORIENTA√á√ÉO]\nJUSTIFICATIVA: [breve explica√ß√£o]\nRECOMENDA√á√ÉO: [pr√≥ximos passos]",
        "timeout": 20000,
        "useBalancer": true
      }
    },
    {
      "id": "appointment_scheduling",
      "type": "message",
      "position": { "x": 700, "y": 300 },
      "data": {
        "label": "Agendamento",
        "message": "üìÖ *Agendamento de Consulta*\n\nVou ajud√°-lo a agendar sua consulta.\n\n*Preciso de algumas informa√ß√µes:*\n\nüë§ *Nome completo*\nüì± *Telefone*\nüéÇ *Data de nascimento*\nüÜî *CPF*\nüí≥ *Tipo de atendimento:*\n   ‚Ä¢ Particular\n   ‚Ä¢ Conv√™nio (qual?)\n   ‚Ä¢ SUS\n\n‚è∞ *Prefer√™ncia de hor√°rio:*\n   ‚Ä¢ Manh√£ (8h-12h)\n   ‚Ä¢ Tarde (13h-17h)\n   ‚Ä¢ Qualquer hor√°rio\n\n*Por favor, me informe esses dados.*"
      }
    },
    {
      "id": "collect_patient_data",
      "type": "llm",
      "position": { "x": 900, "y": 300 },
      "data": {
        "label": "Coletar Dados Paciente",
        "prompt": "Extraia as informa√ß√µes do paciente da mensagem:\n\nMensagem: {{user_message}}\n\nRetorne no formato JSON:\n{\n  \"nome\": \"nome completo ou null\",\n  \"telefone\": \"telefone ou null\",\n  \"nascimento\": \"data nascimento ou null\",\n  \"cpf\": \"cpf ou null\",\n  \"convenio\": \"particular/convenio/sus ou null\",\n  \"convenio_nome\": \"nome do conv√™nio ou null\",\n  \"preferencia_horario\": \"manha/tarde/qualquer ou null\"\n}\n\nSe alguma informa√ß√£o n√£o estiver presente, use null.",
        "timeout": 15000,
        "useBalancer": true
      }
    },
    {
      "id": "check_availability",
      "type": "webhook",
      "position": { "x": 1100, "y": 300 },
      "data": {
        "label": "Verificar Disponibilidade",
        "url": "{{CLINIC_SYSTEM_URL}}/availability",
        "method": "GET",
        "payload": {
          "doctor_id": "{{doctor_id}}",
          "date_from": "{{current_date}}",
          "date_to": "{{date_plus_30_days}}",
          "period": "{{patient_preference}}"
        }
      }
    },
    {
      "id": "show_available_slots",
      "type": "llm",
      "position": { "x": 1300, "y": 300 },
      "data": {
        "label": "Mostrar Hor√°rios",
        "prompt": "Com base na disponibilidade retornada, crie uma mensagem amig√°vel mostrando os hor√°rios dispon√≠veis:\n\nDados do paciente: {{patient_data}}\nDisponibilidade: {{availability_data}}\n\nFormato da resposta:\n\"üìÖ *Hor√°rios dispon√≠veis para voc√™:*\n\n[Lista dos pr√≥ximos 5 hor√°rios mais pr√≥ximos]\n\n*Digite o n√∫mero da op√ß√£o escolhida:*\n1Ô∏è‚É£ [Data] √†s [Hora]\n2Ô∏è‚É£ [Data] √†s [Hora]\n...\n\nüí° *Dica: Confirme o hor√°rio o quanto antes para garantir sua vaga!*\"",
        "timeout": 15000,
        "useBalancer": true
      }
    },
    {
      "id": "confirm_appointment",
      "type": "message",
      "position": { "x": 1500, "y": 300 },
      "data": {
        "label": "Confirmar Consulta",
        "message": "‚úÖ *Consulta Agendada com Sucesso!*\n\nüìã *Detalhes da sua consulta:*\n‚Ä¢ Data: {{scheduled_date}}\n‚Ä¢ Hor√°rio: {{scheduled_time}}\n‚Ä¢ Paciente: {{patient_name}}\n‚Ä¢ Conv√™nio: {{insurance_type}}\n\nüìç *Local:*\nConsult√≥rio Dr. [Nome]\n[Endere√ßo completo]\n\n‚è∞ *Importante:*\n‚Ä¢ Chegue 15 minutos antes\n‚Ä¢ Traga documento com foto\n‚Ä¢ Traga carteirinha do conv√™nio\n‚Ä¢ Liste suas medica√ß√µes atuais\n\nüîî *Lembretes autom√°ticos:*\n‚Ä¢ 24h antes: WhatsApp\n‚Ä¢ 2h antes: SMS\n\n*Deseja adicionar algo mais?*"
      }
    },
    {
      "id": "save_appointment",
      "type": "webhook",
      "position": { "x": 1700, "y": 300 },
      "data": {
        "label": "Salvar Consulta",
        "url": "{{CLINIC_SYSTEM_URL}}/appointments",
        "method": "POST",
        "payload": {
          "patient_data": "{{patient_info}}",
          "appointment_datetime": "{{scheduled_datetime}}",
          "doctor_id": "{{doctor_id}}",
          "type": "consultation",
          "status": "scheduled",
          "source": "whatsapp_bot",
          "reminders": {
            "24h_before": true,
            "2h_before": true
          }
        }
      }
    },
    {
      "id": "exam_results",
      "type": "message",
      "position": { "x": 500, "y": 500 },
      "data": {
        "label": "Resultados Exames",
        "message": "üìã *Consulta de Resultados de Exames*\n\n*Para acessar seus resultados, preciso verificar sua identidade:*\n\nüÜî *CPF do paciente*\nüéÇ *Data de nascimento*\nüìÖ *Data aproximada do exame*\n\n‚ö†Ô∏è *Por seguran√ßa e privacidade:*\n‚Ä¢ Resultados s√≥ ser√£o liberados ap√≥s confirma√ß√£o dos dados\n‚Ä¢ Em caso de d√∫vida, fale com a recepcionista\n‚Ä¢ Resultados alterados requerem consulta m√©dica\n\n*Por favor, informe os dados solicitados.*"
      }
    },
    {
      "id": "verify_patient_identity",
      "type": "webhook",
      "position": { "x": 700, "y": 500 },
      "data": {
        "label": "Verificar Identidade",
        "url": "{{CLINIC_SYSTEM_URL}}/verify-patient",
        "method": "POST",
        "payload": {
          "cpf": "{{patient_cpf}}",
          "birth_date": "{{patient_birth_date}}",
          "exam_date": "{{exam_date_approx}}"
        }
      }
    },
    {
      "id": "provide_results",
      "type": "llm",
      "position": { "x": 900, "y": 500 },
      "data": {
        "label": "Fornecer Resultados",
        "prompt": "Com base nos resultados dos exames verificados, forne√ßa uma resposta adequada:\n\nResultados: {{exam_results}}\nStatus: {{verification_status}}\n\nSe os resultados est√£o normais:\n- Parabenize o paciente\n- Reforce a import√¢ncia dos exames preventivos\n- Oriente sobre pr√≥ximos passos\n\nSe h√° altera√ß√µes:\n- N√ÉO interprete resultados m√©dicos\n- Oriente a agendar consulta com m√©dico\n- Tranquilize sem minimizar\n- Ofere√ßa agendamento priorit√°rio\n\nSempre manter tom profissional e emp√°tico.",
        "timeout": 20000,
        "useBalancer": true
      }
    },
    {
      "id": "schedule_followup",
      "type": "message",
      "position": { "x": 1100, "y": 500 },
      "data": {
        "label": "Agendar Retorno",
        "message": "üë®‚Äç‚öïÔ∏è *Consulta de Retorno Recomendada*\n\nPara melhor avalia√ß√£o dos seus resultados, recomendamos:\n\n‚ö° *Consulta priorit√°ria dispon√≠vel:*\n‚Ä¢ Hoje: 16h30\n‚Ä¢ Amanh√£: 9h15, 14h45\n‚Ä¢ Depois de amanh√£: 10h30, 15h20\n\nüìû *Ou prefere que eu conecte com a recepcionista?*\n\nüí° *Dica: Consultas para discuss√£o de exames t√™m prioridade no agendamento.*\n\n*Qual op√ß√£o prefere?*"
      }
    },
    {
      "id": "medication_reminder",
      "type": "message",
      "position": { "x": 300, "y": 700 },
      "data": {
        "label": "Lembrete Medica√ß√£o",
        "message": "üíä *Central de Medicamentos*\n\n*Como posso ajud√°-lo com suas medica√ß√µes?*\n\n‚è∞ Configurar lembrete de medica√ß√£o\nüìã Listar medica√ß√µes atuais\nüîÑ Alterar hor√°rio de medica√ß√£o\n‚ùå Cancelar lembrete\nüì± Receber via WhatsApp\nüìß Receber via email\n\n*Qual op√ß√£o deseja?*\n\nüí° *Lembretes autom√°ticos aumentam a ades√£o ao tratamento em 40%!*"
      }
    },
    {
      "id": "health_tips",
      "type": "llm",
      "position": { "x": 500, "y": 700 },
      "data": {
        "label": "Dicas de Sa√∫de",
        "prompt": "Forne√ßa uma dica de sa√∫de relevante e personalizada baseada no contexto:\n\nContexto da conversa: {{conversation_context}}\nPerfil do paciente: {{patient_profile}}\n\nTemas para dicas:\n- Preven√ß√£o de doen√ßas\n- H√°bitos saud√°veis\n- Exerc√≠cios apropriados\n- Alimenta√ß√£o balanceada\n- Sa√∫de mental\n- Cuidados espec√≠ficos por idade\n\nMantenha tom educativo, n√£o prescritivo. Sempre sugira consultar m√©dico para orienta√ß√µes espec√≠ficas.",
        "timeout": 15000,
        "useBalancer": true
      }
    },
    {
      "id": "final_medical_message",
      "type": "message",
      "position": { "x": 700, "y": 700 },
      "data": {
        "label": "Mensagem Final",
        "message": "üè• *Obrigado por escolher nosso consult√≥rio!*\n\nSua sa√∫de √© nossa prioridade. Esperamos t√™-lo ajudado da melhor forma.\n\nüìû *Contatos do consult√≥rio:*\n‚Ä¢ Recep√ß√£o: (11) 3333-3333\n‚Ä¢ WhatsApp: (11) 9999-9999\n‚Ä¢ Email: contato@consultorio.com\n\nüïê *Hor√°rio de funcionamento:*\n‚Ä¢ Segunda a Sexta: 8h √†s 18h\n‚Ä¢ S√°bado: 8h √†s 12h\n\nüîÑ *Para usar novamente:*\n‚Ä¢ Digite *menu* para voltar ao in√≠cio\n‚Ä¢ Digite *!flow stop* para encerrar\n\n*Cuide-se bem! üíö*"
      }
    }
  ],
  "edges": [
    { "id": "e1", "source": "start-1", "target": "medical_welcome" },
    { "id": "e2", "source": "medical_welcome", "target": "classify_request" },
    { "id": "e3", "source": "classify_request", "target": "check_emergency" },
    { "id": "e4", "source": "check_emergency", "target": "emergency_response", "label": "true" },
    { "id": "e5", "source": "check_emergency", "target": "symptom_triage", "label": "false" },
    { "id": "e6", "source": "symptom_triage", "target": "appointment_scheduling" },
    { "id": "e7", "source": "appointment_scheduling", "target": "collect_patient_data" },
    { "id": "e8", "source": "collect_patient_data", "target": "check_availability" },
    { "id": "e9", "source": "check_availability", "target": "show_available_slots" },
    { "id": "e10", "source": "show_available_slots", "target": "confirm_appointment" },
    { "id": "e11", "source": "confirm_appointment", "target": "save_appointment" },
    { "id": "e12", "source": "save_appointment", "target": "final_medical_message" },
    { "id": "e13", "source": "medical_welcome", "target": "exam_results" },
    { "id": "e14", "source": "exam_results", "target": "verify_patient_identity" },
    { "id": "e15", "source": "verify_patient_identity", "target": "provide_results" },
    { "id": "e16", "source": "provide_results", "target": "schedule_followup" },
    { "id": "e17", "source": "schedule_followup", "target": "final_medical_message" }
  ],
  "configuration": {
    "webhooks": {
      "clinic_system": {
        "base_url": "https://api.clinicsystem.com",
        "auth_header": "Authorization: Bearer {{CLINIC_API_KEY}}",
        "timeout": 10000
      }
    },
    "variables": {
      "CLINIC_SYSTEM_URL": "https://api.clinicsystem.com/v1",
      "CLINIC_API_KEY": "your-clinic-api-key",
      "doctor_id": "dr001",
      "clinic_name": "Consult√≥rio Dr. [Nome]",
      "clinic_address": "[Endere√ßo completo]"
    },
    "settings": {
      "emergency_phone": "192",
      "clinic_phone": "(11) 3333-3333",
      "appointment_duration": 30,
      "max_advance_days": 60,
      "reminder_24h": true,
      "reminder_2h": true,
      "privacy_verification_required": true
    }
  }
}