<div class="container mx-auto p-4 md:p-6">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 flex items-center">
        <svg class="w-10 h-10 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
        An√°lise de Perfil do LinkedIn
    </h1>

    <!-- Credential Status -->
    <div class="mb-6 p-4 rounded-lg <%= locals.credentialStatus?.hasCredentials ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
        <h2 class="font-bold text-lg"><%= locals.credentialStatus?.status || 'Status das Credenciais Indispon√≠vel' %></h2>
        <p><%= locals.credentialStatus?.message || 'N√£o foi poss√≠vel verificar as credenciais.' %></p>
        <% if (!locals.credentialStatus?.hasCredentials) { %>
            <a href="/config" class="text-blue-600 hover:underline mt-2 inline-block">Ir para a p√°gina de configura√ß√£o</a>
        <% } %>
    </div>
    
    <!-- Formul√°rio de An√°lise -->
    <form action="/linkedin/analyze" method="POST" class="bg-white p-6 rounded-lg shadow-md mb-8">
        <div class="mb-4">
            <label for="url" class="block text-gray-700 font-bold mb-2">URL do Perfil do LinkedIn:</label>
            <input type="url" id="url" name="url" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="https://www.linkedin.com/in/..." required value="<%= locals.url || '' %>">
        </div>
        <div class="mb-4">
             <label for="analysisType" class="block text-gray-700 font-bold mb-2">Tipo de An√°lise:</label>
             <select id="analysisType" name="analysisType" class="shadow border rounded w-full py-2 px-3 text-gray-700">
                 <option value="structured" <%= (locals.analysisType === 'structured' || !locals.analysisType) ? 'selected' : '' %>>Estruturada (Completa)</option>
                 <option value="raw" <%= locals.analysisType === 'raw' ? 'selected' : '' %>>Apenas Texto Bruto</option>
             </select>
        </div>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            Analisar Perfil
        </button>
    </form>
    
    <!-- Resultados da An√°lise -->
    <% if (locals.analysis) { %>
        <% const data = analysis.data; %>
        <div class="bg-white p-4 md:p-6 rounded-lg shadow-xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Resultados da An√°lise</h2>

            <!-- Profile Header -->
            <div class="relative mb-6">
                <% if (data.bannerUrl) { %>
                    <img src="<%= data.bannerUrl %>" alt="Banner do Perfil" class="w-full h-32 md:h-48 object-cover rounded-t-lg">
                <% } else { %>
                    <div class="w-full h-32 md:h-48 bg-gray-200 rounded-t-lg"></div>
                <% } %>
                <div class="absolute bottom-0 left-4 transform translate-y-1/2">
                    <% if (data.profilePictureUrl) { %>
                        <img src="<%= data.profilePictureUrl %>" alt="Foto do Perfil" class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-white shadow-lg">
                    <% } %>
                </div>
            </div>

            <div class="pt-12 md:pt-16 px-4">
                <h3 class="text-3xl font-bold"><%= data.name || 'Nome n√£o encontrado' %></h3>
                <p class="text-lg text-gray-700"><%= data.headline || 'T√≠tulo n√£o encontrado' %></p>
                <p class="text-md text-gray-500"><%= data.location || 'Localiza√ß√£o n√£o encontrada' %></p>
                <p class="text-md text-gray-500"><%= data.connections || 'Conex√µes n√£o encontradas' %></p>
            </div>
            
            <div class="mt-4 border-t border-gray-200 pt-4 px-4">
                <div class="flex items-center">
                    <span class="font-bold mr-2">Qualidade dos Dados:</span>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="bg-blue-500 h-4 rounded-full" style="width: <%= analysis.dataQuality.percentage %>%"></div>
                    </div>
                    <span class="ml-2 font-semibold"><%= analysis.dataQuality.percentage %>%</span>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                <!-- Coluna Esquerda: Sobre e Texto Bruto -->
                <div class="md:col-span-1 space-y-6">
                    <!-- Sobre -->
                    <% if (data.about) { %>
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                            <h4 class="font-bold text-xl mb-2">Sobre</h4>
                            <p class="text-gray-700 whitespace-pre-wrap"><%= data.about %></p>
                        </div>
                    <% } %>
                    <!-- Texto Bruto -->
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                        <h4 class="font-bold text-xl mb-2">Texto Bruto Extra√≠do</h4>
                        <textarea class="w-full h-64 bg-gray-100 p-2 border rounded text-sm" readonly><%= analysis.rawText || 'Nenhum texto bruto foi extra√≠do.' %></textarea>
                    </div>
                </div>

                <!-- Coluna Direita: Detalhes em Acorde√£o -->
                <div class="md:col-span-2 space-y-4">
                    <!-- Experi√™ncia -->
                    <% if (data.experience && data.experience.length > 0) { %>
                    <details class="bg-white shadow rounded group" open>
                        <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4">
                            <span class="text-lg">üíº Experi√™ncia Profissional</span>
                            <span class="transition group-open:rotate-180">
                                <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                            </span>
                        </summary>
                        <div class="text-neutral-600 border-t p-4">
                            <% data.experience.forEach(exp => { %>
                                <div class="mb-4 pb-4 border-b last:border-b-0">
                                    <h5 class="font-bold"><%= exp.title %></h5>
                                    <p class="text-gray-700"><%= exp.company %></p>
                                    <p class="text-sm text-gray-500"><%= exp.duration %></p>
                                    <p class="text-sm text-gray-600 mt-1"><%= exp.description %></p>
                                </div>
                            <% }); %>
                        </div>
                    </details>
                    <% } %>

                    <!-- Educa√ß√£o -->
                    <% if (data.education && data.education.length > 0) { %>
                    <details class="bg-white shadow rounded group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4">
                            <span class="text-lg">üéì Educa√ß√£o</span>
                            <span class="transition group-open:rotate-180">
                                <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                            </span>
                        </summary>
                        <div class="text-neutral-600 border-t p-4">
                            <% data.education.forEach(edu => { %>
                                <div class="mb-3 pb-3 border-b last:border-b-0">
                                    <h5 class="font-bold"><%= edu.degree %></h5>
                                    <p class="text-gray-700"><%= edu.school %></p>
                                    <p class="text-sm text-gray-500"><%= edu.years %></p>
                                </div>
                            <% }); %>
                        </div>
                    </details>
                    <% } %>
                    
                    <!-- Skills -->
                    <% if (data.skills && data.skills.length > 0) { %>
                    <details class="bg-white shadow rounded group">
                        <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4">
                            <span class="text-lg">üõ†Ô∏è Habilidades</span>
                        </summary>
                        <div class="text-neutral-600 border-t p-4">
                             <div class="flex flex-wrap gap-2">
                                <% data.skills.forEach(skill => { %>
                                    <span class="bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded"><%= skill %></span>
                                <% }); %>
                            </div>
                        </div>
                    </details>
                    <% } %>
                    
                    <!-- Outras Se√ß√µes (Certifica√ß√µes, Publica√ß√µes, etc.) -->
                    <% const otherSections = [
                        { title: 'üìú Certifica√ß√µes', data: data.certifications, key: 'cert' },
                        { title: 'üìö Publica√ß√µes', data: data.publications, key: 'pub' },
                        { title: 'üèÜ Honras e Pr√™mios', data: data.honors, key: 'honor' },
                        { title: 'üåê Idiomas', data: data.languages, key: 'lang' },
                        { title: 'ü§ù Voluntariado', data: data.volunteering, key: 'vol' }
                    ]; %>

                    <% otherSections.forEach(section => { %>
                        <% if (section.data && section.data.length > 0) { %>
                        <details class="bg-white shadow rounded group">
                             <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4">
                                <span class="text-lg"><%- section.title %></span>
                             </summary>
                             <div class="text-neutral-600 border-t p-4">
                                <% section.data.forEach(item => { %>
                                    <div class="mb-3 pb-3 border-b last:border-b-0">
                                    <% if (section.key === 'cert') { %>
                                        <h5 class="font-bold"><%= item.name %></h5>
                                        <p><%= item.issuer %> - <%= item.issuedDate %></p>
                                    <% } else if (section.key === 'pub') { %>
                                         <h5 class="font-bold"><%= item.title %></h5>
                                         <p><%= item.publisher %> - <%= item.date %></p>
                                    <% } else if (section.key === 'honor') { %>
                                         <h5 class="font-bold"><%= item.title %></h5>
                                         <p><%= item.issuer %> - <%= item.date %></p>
                                    <% } else if (section.key === 'lang') { %>
                                         <h5 class="font-bold"><%= item.language %></h5>
                                         <p><%= item.proficiency %></p>
                                    <% } else if (section.key === 'vol') { %>
                                        <h5 class="font-bold"><%= item.role %></h5>
                                        <p><%= item.organization %> - <%= item.duration %></p>
                                    <% } %>
                                    </div>
                                <% }); %>
                            </div>
                        </details>
                        <% } %>
                    <% }); %>
                </div>
            </div>
        </div>
    <% } %>
</div>

